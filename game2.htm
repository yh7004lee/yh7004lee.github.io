<!-- game2.htm -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>ë§ì”€ ë¹ˆì¹¸ ì±„ìš°ê¸° ê²Œì„</title>
  <style>
    body {
      font-family: 'ë§‘ì€ ê³ ë”•', sans-serif;
      background-color: #121212;
      color: #f0f0f0;
      margin: 0;
      padding: 5px 20px;
    }

    h3 {
      font-size: 1.4rem;
      margin-top: 20px;
    }

#verseText {
  margin:10px 0 30px 0;              /* ìƒí•˜ ë§ˆì§„ ë” ì¤Œ */
  padding: 15px;               /* ì•ˆìª½ ì—¬ë°± ì¶”ê°€ */
  font-size: 1.1rem;
  line-height: 3;              /* ì¤„ê°„ê²© ë„‰ë„‰í•˜ê²Œ */
      border: 2px dashed #888;
  border-radius: 12px;         /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
  background-color: #1a1a1a;   /* ì•½ê°„ ë‹¤ë¥¸ ë°°ê²½ìƒ‰ */
}
    input.blank {
      width: 80px;
      font-size: 1rem;
      padding: 6px;
      border: 1px solid #888;
      border-radius: 6px;
      background-color: #1e1e1e;
      color: #f0f0f0;
      text-align: center;
    }

    button {
      display: block;
      width: 100%;
      margin: 15px 0;
      padding: 10px;
      font-size: 1.1rem;
      background-color: #444;
      color: #f0f0f0;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }

    button:hover {
      background-color: #666;
    }

    #result {
      text-align: center;
      font-weight: bold;
      font-size: 1.2rem;
    }

  /* ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ */
  /* ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ */
#verseTitle {
  margin: 10px 0 10px 0;
}
#navButtons {
  display: flex;
  gap: 6px; /* ë²„íŠ¼ ì‚¬ì´ ê°„ê²© ì•½ê°„ ì¶•ì†Œ */
  margin-top: 6px; /* ìƒë‹¨ ì—¬ë°± ì¶•ì†Œ */
}
#navButtons .navBtn {
  flex: 1;
  padding: 6px 0;           /* ì„¸ë¡œ íŒ¨ë”© ì¶•ì†Œ */
  font-size: 0.95rem;       /* ê¸€ì í¬ê¸° ì¶•ì†Œ */
  background-color: #444;
  color: #f0f0f0;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  user-select: none;
  transition: background-color 0.3s ease;
  margin: 0;                /* ë¶ˆí•„ìš”í•œ ë§ˆì§„ ì œê±° */
}

    .navBtn.active {
      background-color: #03dac6 !important;
      color: #000 !important;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <div id="navButtons" style="margin-top: 10px;">
    <button class="navBtn" onclick="goToPrev()">ì´ì „</button>
    <button id="allVersesBtn" class="navBtn active">ëª¨ë‘</button>
    <button id="favVersesBtn" class="navBtn">ì¦ì°¾</button>
    <button class="navBtn" onclick="goToNext()">ë‹¤ìŒ</button>
  </div>

  <h3 id="verseTitle">ë§ì”€ ì œëª©</h3>
  <div id="verseText">ì—¬ê¸°ì— ë§ì”€ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>

  <button id="checkBtn">âœ… ì •ë‹µ í™•ì¸</button>
  <button id="restartBtn" style="display:none;">ğŸ”„ ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
  <button id="mainBtn">ğŸ° ë§ì”€ì•”ì†¡ ë©”ì¸í™”ë©´</button>

  <div id="result"></div>

  <script>
  const STORAGE_KEY_VERSES = 'savedVerses2';
  let allVerses = [];
  let verses = [];
  let currentStage = 0;
  let score = 0;
  let answerWords = [];
  let wrongAttempts = 0; // ğŸ‘ˆ ì´ í‹€ë¦° íšŸìˆ˜ ëˆ„ì ìš©

  const verseTitle = document.getElementById('verseTitle');
  const verseText = document.getElementById('verseText');
  const checkBtn = document.getElementById('checkBtn');
  const restartBtn = document.getElementById('restartBtn');
  const result = document.getElementById('result');
  const allVersesBtn = document.getElementById('allVersesBtn');
  const favVersesBtn = document.getElementById('favVersesBtn');

  function loadVerses() {
    const saved = localStorage.getItem(STORAGE_KEY_VERSES);
    if (!saved) return null;
    try {
      const parsed = JSON.parse(saved);
      return parsed.map((v, i) => ({
        ...v,
        id: i,
        title: v.title || '',
        text: v.text || '',
        textEn: v.textEn || '',
        favorite: v.favorite || false
      }));
    } catch {
      return null;
    }
  }

  function renderStage() {
    if (currentStage >= verses.length) {
      const inputs = verseText.querySelectorAll('input.blank');
      inputs.forEach(input => {
        input.style.border = '';
      });

      verseTitle.textContent = 'ğŸ‰ ëª¨ë“  ìŠ¤í…Œì´ì§€ ì™„ë£Œ!';
      verseText.innerHTML = '';
      checkBtn.style.display = 'none';
      result.textContent = `ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!! `;
      restartBtn.style.display = 'block';
      return;
    }

    const verse = verses[currentStage];
    verseTitle.textContent = verse.title || `ìŠ¤í…Œì´ì§€ ${currentStage + 1}`;
    let words = verse.text.replace('[ê°œì—­í•œê¸€]', '').trim().split(/\s+/);
    const indexes = [];

    while (indexes.length < 4) {
      const idx = Math.floor(Math.random() * words.length);
      if (!indexes.includes(idx) && !/^\[.*\]$/.test(words[idx])) indexes.push(idx);
    }

    answerWords = [];
    let html = words.map((w, i) => {
      if (indexes.includes(i)) {
        answerWords.push(w);
        return `<input type="text" class="blank" data-idx="${i}" />`;
      }
      return w;
    }).join(' ');

    verseText.innerHTML = html;
    result.textContent = '';
    checkBtn.style.display = 'block';
    restartBtn.style.display = 'none';
  }

  checkBtn.addEventListener('click', () => {
    const inputs = [...verseText.querySelectorAll('input.blank')];
    const userAnswers = inputs.map(input => input.value.trim());

    let correct = true;
    inputs.forEach((input, idx) => {
      if (userAnswers[idx] === answerWords[idx]) {
        input.style.border = '';
      } else {
        input.style.border = '2px dashed #ff5c5c';
        input.style.borderRadius = '6px';
        correct = false;
        wrongAttempts++;
      }
    });

    // í­ì£½ì‹œì‘
    if (correct) {
      score++;

      const rect = verseText.getBoundingClientRect();
      const fireworkX = rect.left + rect.width / 2;
      const fireworkY = rect.top + rect.height / 2;
      createFirework(fireworkX, fireworkY, true);

      if (currentStage < verses.length - 1) {
        result.textContent = 'ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤! ë‹¤ìŒ ìŠ¤í…Œì´ì§€ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.';
        result.style.color = 'lightgreen';
        currentStage++;
        setTimeout(renderStage, 1500);
      } else {
        result.textContent = 'ğŸ‰ ë§ˆì§€ë§‰ ìŠ¤í…Œì´ì§€ ì •ë‹µì…ë‹ˆë‹¤!';
        result.style.color = 'lightgreen';
        currentStage++;
        setTimeout(renderStage, 1500);
      }
    }
  });

  function createFirework(x, y, fromTop = false) {
    const firework = document.createElement('div');
    firework.style.position = 'absolute';
    firework.style.left = `${x}px`;
    firework.style.top = `${y}px`;
    firework.style.pointerEvents = 'none';
    firework.style.width = '0px';
    firework.style.height = '0px';

    const colors = ['#ff5252', '#03dac6', '#ffeb3b', '#ff9800', '#ffffff'];

    for (let i = 0; i < 60; i++) {
      const particle = document.createElement('div');
      const angle = Math.random() * 2 * Math.PI;
      const radius = Math.random() * 250 + 150;

      const px = Math.cos(angle) * radius;
      const py = Math.sin(angle) * radius;

      particle.style.position = 'absolute';
      particle.style.width = '10px';
      particle.style.height = '10px';
      particle.style.borderRadius = '50%';
      particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
      particle.style.transform = 'translate(0, 0)';
      particle.style.opacity = '1';
      particle.style.transition = 'transform 2s ease-out, opacity 2s';

      setTimeout(() => {
        particle.style.transform = `translate(${px}px, ${fromTop ? py + 100 : py}px)`;
        particle.style.opacity = '0';
      }, 10);

      firework.appendChild(particle);
    }

    document.body.appendChild(firework);
    setTimeout(() => firework.remove(), 2500);
  }

  restartBtn.addEventListener('click', () => {
    currentStage = 0;
    score = 0;
    renderStage();
  });

  document.getElementById('mainBtn').addEventListener('click', () => {
    window.location.href = 'bible.htm';
  });

  function goToPrev() {
    if (currentStage > 0) {
      currentStage--;
      renderStage();
    }
  }

  function goToNext() {
    if (currentStage < verses.length - 1) {
      currentStage++;
      renderStage();
    }
  }

  function setMode(isFavoriteOnly) {
    allVerses = loadVerses() || [];

    if (isFavoriteOnly) {
      const favList = allVerses.filter(v => v.favorite);
      if (favList.length === 0) {
        alert('ì¦ê²¨ì°¾ê¸°ëœ ë§ì”€ì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      favVersesBtn.classList.add('active');
      allVersesBtn.classList.remove('active');
      verses = favList;
    } else {
      allVersesBtn.classList.add('active');
      favVersesBtn.classList.remove('active');
      verses = allVerses;
    }

    currentStage = 0;
    score = 0;
    renderStage();
  }

  allVersesBtn.addEventListener('click', () => setMode(false));
  favVersesBtn.addEventListener('click', () => setMode(true));

  window.onload = () => {
    allVerses = loadVerses();
    if (!allVerses || allVerses.length === 0) {
      verseTitle.textContent = 'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. bible.htmì—ì„œ ë¨¼ì € ì €ì¥í•´ì£¼ì„¸ìš”.';
      checkBtn.style.display = 'none';
    } else {
      setMode(false);
    }
  };
</script>

</body>
</html>
