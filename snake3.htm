<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ÎßêÏîÄ Ïä§ÎÑ§Ïù¥ÌÅ¨ Í≤åÏûÑ</title>
  <style>
  body {
    font-family: 'Segoe UI', 'Arial', sans-serif;
    background: #1a1d24; /* Ïñ¥Îë°ÏßÄÎßå Î∏îÎ£®Í∑∏Î†àÏù¥ Í∏∞Ïö¥ */
    color: #e0f7fa;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0 10px;
  }

  canvas {
    background: #21262e;
    border: 3px solid #f39c12;
    margin-top: 15px;
    width: calc(100vw - 20px);
    height: calc(100vw - 20px);
    max-width: 500px;
    max-height: 500px;
    border-radius: 0px;
  }

  h1 {
    color: #00e0d3;
    margin: 5px 0;
    font-size: 24px;
  }

  #verseTitle {
    color: #fff;
    font-size: 20px;
    margin-bottom: 5px;
  }

  #modeDisplay {
    color: #00e0d3;
    font-size: 16px;
    margin: 5px 0;
  }

  button {
    padding: 8px 14px;
   font-size: 0.95rem; 
    margin: 5px;
    border: none;
    border-radius: 10px;
    background: #2a2f3a;
    color: #e0f7fa;
    font-weight: 500;
    cursor: pointer;
    flex: 1;
    transition: background 0.2s, transform 0.1s;
  }

  button:hover {
    background: #39414f;
  
  }

  button.selected {
    background-color: #00e0d3;
    color: #1a1d24;
    font-weight: bold;
box-shadow: 0 0 10px #00e0d3, 0 0 20px #00e0d3;

  }

  .controls, .speed-select {
    display: flex;
    gap: 10px;
    flex-wrap: nowrap;
    justify-content: space-between;
    margin-top: 10px;
    width: 100%;
    max-width: 500px;
  }

  #verse {
    margin-top: 10px;
    font-size: 18px;
    text-align: center;
    max-width: 90vw;
    color: #b2ebf2;
  }

.controls button {
  font-size: 18px; /* Í∏ÄÍº¥ ÌÅ¨Í∏∞ ÌÇ§Ïö∞Í∏∞ */
  padding: 7px 10px;    /* Ìå®Îî© ÌÇ§ÏõåÏÑú Î≤ÑÌäºÎèÑ Ïª§ÏßÄÍ≤å */
  flex: 1;
}
#navButtons {
    display: flex;
    gap: 10px;
    flex-wrap: nowrap;
    justify-content: space-between;
    margin: 10px 0 15px 0;
    width: 100%;
    max-width: 500px;
}
#navButtons .navBtn {
  flex: 1;
  padding: 8px 0;           /* ÏÑ∏Î°ú Ìå®Îî© Ï∂ïÏÜå */
  font-size: 0.95rem;       /* Í∏ÄÏûê ÌÅ¨Í∏∞ Ï∂ïÏÜå */
  background-color: #2a2f3a;
  color: #f0f0f0;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  user-select: none;
  transition: background-color 0.3s ease;
  margin: 5px;                /* Î∂àÌïÑÏöîÌïú ÎßàÏßÑ Ï†úÍ±∞ */
}
    #navButtons .navBtn:hover {
      background-color: #39414f;
    }  
 .navBtn.active {
  background-color: #03dac6 !important;
  color: #000000 !important;
font-weight: bold;
box-shadow: 0 0 10px #00e0d3, 0 0 20px #00e0d3;
}
</style>

</head>
<body>
  <!-- ÏÉÅÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î≤ÑÌäº -->
  <div id="navButtons" style="display:flex; gap:8px; margin-top:10px;">

    <button class="navBtn" onclick="goToPrev()"> Ïù¥Ï†Ñ</button>
<button id="allVersesBtn" class="navBtn active">Î™®Îëê</button>
<button id="favVersesBtn" class="navBtn">Ï¶êÏ∞æ</button>
    <button class="navBtn" onclick="goToNext()"> Îã§Ïùå</button>
   
  </div>

  <div id="verseTitle"></div>
<div class="speed-select">
  <button id="btn-beginner" onclick="setSpeed(400, 'Ï¥àÎ≥¥', this)">Ï¥àÎ≥¥</button>
  <button id="btn-intermediate" onclick="setSpeed(250, 'Ï§ëÏàò', this)">Ï§ëÏàò</button>
  <button id="btn-advanced" onclick="setSpeed(150, 'Í≥†Ïàò', this)">Í≥†Ïàò</button>
  <button id="btn-master" onclick="setSpeed(80, 'Ï¥àÏù∏', this)">Ï¥àÏù∏</button>
</div>
  <div id="modeDisplay" style="display: none;">ÌòÑÏû¨ Î™®Îìú: Ï¥àÎ≥¥ Î™®ÎìúÏûÖÎãàÎã§.</div>

  <canvas id="game" width="300" height="300"></canvas>

  <div class="controls">
    <button onclick="setDirection('up')">‚áß</button>  
    <button onclick="setDirection('down')">‚á©</button>
  <button onclick="setDirection('left')">‚á¶</button>
    <button onclick="setDirection('right')">‚á®</button>
  </div>

  <div id="verse"></div>






  <script>
  const STORAGE_KEY_VERSES = 'savedVerses2';
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const gridSize = 10;

  let verses = [];
  let currentStage = 0;
  let verseWords = [];
  let wordIndex = 0;
  let collectedWords = [];
  let intervalId = null;
  let currentSpeed = 400;

  let snake = [{ x: 5, y: 5 }];
  let dir = { x: 0, y: 0 };
  let foods = [];

  const modeWordCounts = {
    'Ï¥àÎ≥¥': 2,
    'Ï§ëÏàò': 3,
    'Í≥†Ïàò': 4,
    'Ï¥àÏù∏': 5
  };

  let currentMode = 'Ï¥àÎ≥¥';

  function setSpeed(speed, label, btnElement = null) {
    currentSpeed = speed;
    currentMode = label;
    document.getElementById('modeDisplay').innerText = `ÌòÑÏû¨ Î™®Îìú: ${label} Î™®ÎìúÏûÖÎãàÎã§.`;
    if (intervalId) clearInterval(intervalId);
    intervalId = setInterval(update, currentSpeed);

    const buttons = document.querySelectorAll('.speed-select button');
    buttons.forEach(btn => btn.classList.remove('selected'));
    if (btnElement) btnElement.classList.add('selected');

    loadStage();
  }

  function setDirection(d) {
    if (d === 'up' && dir.y !== 1) dir = { x: 0, y: -1 };
    if (d === 'down' && dir.y !== -1) dir = { x: 0, y: 1 };
    if (d === 'left' && dir.x !== 1) dir = { x: -1, y: 0 };
    if (d === 'right' && dir.x !== -1) dir = { x: 1, y: 0 };
  }

  function loadStage() {
    if (currentStage >= verses.length) {
      showCustomAlert('üëè Î™®Îì† ÎßêÏîÄÏùÑ ÏôÑÎ£åÌñàÏäµÎãàÎã§!');
      document.getElementById('verseTitle').innerText = '';
      document.getElementById('verse').innerText = '';
      if (intervalId) clearInterval(intervalId);
      return;
    }
    const verse = verses[currentStage];
    document.getElementById('verseTitle').innerText = ` ${verse.title}`;
    const cleanedText = verse.text.replace(/\[.*?\]/g, '').trim();
    verseWords = cleanedText.split(/\s+/);
    showCustomAlert(`‚ú® ${currentStage + 1}Î≤àÏß∏ Í≤åÏûÑÏù¥ Î°úÎî©ÎêòÏóàÏäµÎãàÎã§.\nÏã§Î†•Ïóê Îî∞Îùº Ï¥àÎ≥¥ Ï§ëÏàò Í≥†Ïàò Ï¥àÏù∏ Ï§ëÏóê ÌïúÍ∞ÄÏßÄ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî. Ïä§ÎÑ§Ïù¥ÌÅ¨Î•º ÏõÄÏßÅÏó¨ÏÑú ÎßêÏîÄ Îã®Ïñ¥Î•º ÏàúÏÑúÎåÄÎ°ú Î®πÏñ¥Î≥¥ÏÑ∏Ïöî. ÏÉÅÌïòÏ¢åÏö∞ Î≤ÑÌäºÏùÑ ÎàÑÎ•¥ÏãúÍ±∞ÎÇò ÌôîÎ©¥ÏùÑ ÏÉÅÌïòÏ¢åÏö∞Î°ú Ïä§ÏôÄÏù¥ÌîÑ ÌïòÎ©¥ Ïä§ÎÑ§Ïù¥ÌÅ¨Í∞Ä ÏõÄÏßÅÏù¥Î©¥ÏÑú Í≤åÏûÑÏù¥ ÏãúÏûëÎê©ÎãàÎã§.`);
    wordIndex = 0;
    collectedWords = [];
    resetSnake();
    placeFoods();
    draw();
  }

  function resetSnake() {
    snake = [{ x: 5, y: 5 }];
    dir = { x: 0, y: 0 };
    foods = [];
  }

  function checkOverlap(newFood, existingFoods) {
    const padding = 2;
    const textWidth = ctx.measureText(newFood.word).width;
    const newX = newFood.x * gridSize;
    const newY = newFood.y * gridSize;

    return existingFoods.some(f => {
      const fx = f.x * gridSize;
      const fy = f.y * gridSize;
      const fw = ctx.measureText(f.word).width;
      return !(newX + textWidth + padding < fx || newX > fx + fw + padding || newY !== fy);
    });
  }

  function placeFoods() {
    foods = [];
    const wordCount = modeWordCounts[currentMode] || 2;

    let wordsToShow = [];
    if (wordIndex < verseWords.length) {
      wordsToShow.push({ word: verseWords[wordIndex], correct: true });
    } else {
      return;
    }

    let wrongCandidates = verseWords.filter((w, i) => i !== wordIndex);
    while (wordsToShow.length < wordCount && wrongCandidates.length > 0) {
      const idx = Math.floor(Math.random() * wrongCandidates.length);
      wordsToShow.push({ word: wrongCandidates[idx], correct: false });
      wrongCandidates.splice(idx, 1);
    }

    wordsToShow = shuffleArray(wordsToShow);

    for (let i = 0; i < wordsToShow.length; i++) {
      let pos;
      let attempts = 0;
      do {
        pos = {
          x: Math.floor(Math.random() * (canvas.width / gridSize)),
          y: Math.floor(Math.random() * (canvas.height / gridSize))
        };
        attempts++;
        if (attempts > 100) break; // Î¨¥Ìïú Î£®ÌîÑ Î∞©ÏßÄ
      } while (
        snake.some(s => s.x === pos.x && s.y === pos.y) ||
        foods.some(f => f.x === pos.x && f.y === pos.y) ||
        checkOverlap({ ...pos, word: wordsToShow[i].word }, foods)
      );
      foods.push({ ...pos, word: wordsToShow[i].word, correct: wordsToShow[i].correct });
    }
  }

  function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#2ecc71';
    for (let s of snake) {
      ctx.fillRect(s.x * gridSize, s.y * gridSize, gridSize, gridSize);
    }
    ctx.fillStyle = '#e74c3c';
    ctx.font = 'bold 12px Arial';

   const padding = 5;
for (let f of foods) {
  let textWidth = ctx.measureText(f.word).width;
  let wordX = f.x * gridSize;
  let wordY = f.y * gridSize + 10;

  // Ï¢åÏö∞ Í≤ΩÍ≥Ñ Î≥¥Ï†ï
  if (wordX < padding) {
    wordX = padding;
  } else if (wordX + textWidth > canvas.width - padding) {
    wordX = canvas.width - textWidth - padding;
  }

  // ÏÉÅÌïò Í≤ΩÍ≥Ñ Î≥¥Ï†ï
  if (wordY < 10 + padding) {
    wordY = 10 + padding;
  } else if (wordY > canvas.height - padding) {
    wordY = canvas.height - padding;
  }

  ctx.fillText(f.word, wordX, wordY);
}
  }

  function update() {
    if (dir.x === 0 && dir.y === 0) return;

    const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };
    if (
      head.x < 0 ||
      head.y < 0 ||
      head.x >= canvas.width / gridSize ||
      head.y >= canvas.height / gridSize ||
      snake.some(s => s.x === head.x && s.y === head.y)
    ) {
      showCustomAlert('Í≤åÏûÑ Ïò§Î≤Ñ!');
      loadStage();
      return;
    }

    snake.unshift(head);

    const foodIndex = foods.findIndex(f => f.x === head.x && f.y === head.y);
    if (foodIndex !== -1) {
      const eaten = foods[foodIndex];
      const target = verseWords[wordIndex];

      const isCorrect = eaten.correct && (target.startsWith(eaten.word) || target.includes(eaten.word));
      if (!isCorrect) {
        showCustomAlert('ÌãÄÎ¶∞ Îã®Ïñ¥Î•º Î®πÏóàÏäµÎãàÎã§! Í≤åÏûÑ Ï¢ÖÎ£å!');
        loadStage();
        return;
      } else {
        collectedWords.push(eaten.word);
        wordIndex++;
        if (wordIndex >= verseWords.length) {
          document.getElementById('verse').innerText = 'üéâ ÏôÑÏÑ±Îêú ÎßêÏîÄ: ' + collectedWords.join(' ');
          showCustomAlert('ÎßêÏîÄÏùÑ ÏôÑÏÑ±ÌñàÏäµÎãàÎã§!');
          currentStage++;
          loadStage();
          return;
        }
        placeFoods();
      }
    } else {
      snake.pop();
    }
    draw();
  }

  document.addEventListener('DOMContentLoaded', () => {
    const saved = localStorage.getItem(STORAGE_KEY_VERSES);
    if (!saved) {
      showCustomAlert('ÎßêÏîÄ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. localStorageÏóê ÎßêÏîÄÏùÑ Ï†ÄÏû•Ìï¥Ï£ºÏÑ∏Ïöî.');
      return;
    }
     showCustomAlert('Í≤åÏûÑÏù¥ ÏãúÏûëÎê©ÎãàÎã§!\nÏä§ÎÑ§Ïù¥ÌÅ¨Î•º ÏõÄÏßÅÏó¨ÏÑú ÎßêÏîÄ Îã®Ïñ¥Î•º ÏàúÏÑúÎåÄÎ°ú Î®πÏñ¥Î≥¥ÏÑ∏Ïöî.\nÏÉÅÌïòÏ¢åÏö∞ Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Í±∞ÎÇò Ïä§ÏôÄÏù¥ÌîÑÌïòÎ©¥ ÏãúÏûëÎê©ÎãàÎã§.')
    verses = JSON.parse(saved);
    const beginnerButton = document.getElementById('btn-beginner');
    setSpeed(400, 'Ï¥àÎ≥¥', beginnerButton);
    loadStage();
  });

  let startX, startY;
  canvas.addEventListener('touchstart', e => {
    const touch = e.touches[0];
    startX = touch.clientX;
    startY = touch.clientY;
  });
  canvas.addEventListener('touchend', e => {
    const touch = e.changedTouches[0];
    const dx = touch.clientX - startX;
    const dy = touch.clientY - startY;
    if (Math.abs(dx) > Math.abs(dy)) {
      dx > 0 ? setDirection('right') : setDirection('left');
    } else {
      dy > 0 ? setDirection('down') : setDirection('up');
    }
  });

  document.addEventListener('keydown', e => {
    switch (e.key) {
      case 'ArrowUp':
        setDirection('up');
        break;
      case 'ArrowDown':
        setDirection('down');
        break;
      case 'ArrowLeft':
        setDirection('left');
        break;
      case 'ArrowRight':
        setDirection('right');
        break;
    }
  });

  let showingFavorites = false;

  document.getElementById('allVersesBtn').addEventListener('click', () => {
    showingFavorites = false;
    document.getElementById('allVersesBtn').classList.add('active');
    document.getElementById('favVersesBtn').classList.remove('active');
    const saved = localStorage.getItem(STORAGE_KEY_VERSES);
    if (saved) {
      verses = JSON.parse(saved);
      currentStage = 0;
      loadStage();
    }
  });

  document.getElementById('favVersesBtn').addEventListener('click', () => {
    showingFavorites = true;
    document.getElementById('favVersesBtn').classList.add('active');
    document.getElementById('allVersesBtn').classList.remove('active');

    const saved = localStorage.getItem(STORAGE_KEY_VERSES);
    if (saved) {
      const all = JSON.parse(saved);
      verses = all.filter(v => v.favorite);
      currentStage = 0;
      loadStage();
    }
  });

  function goToPrev() {
    if (currentStage > 0) {
      currentStage--;
      loadStage();
    }
  }

  function goToNext() {
    if (currentStage < verses.length - 1) {
      currentStage++;
      loadStage();
    }
  }

//Î©îÏÑ∏ÏßÄÏ∞Ω
 // Îß•Ïä§ÌÉÄÏùº Î©îÏÑ∏ÏßÄÏ∞Ω (ÌôïÏù∏ Î≤ÑÌäº Í∞úÏÑ†)
(function () {
  const style = document.createElement('style');
  style.textContent = `
    #customModal {
      display: none;
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(5px);
      justify-content: center; align-items: center;
      z-index: 9999;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    }
    #customModal.show {
      display: flex;
    }
    #customModal > div {
      background: #1e1e1e;
      color: #f0f0f0;
      padding: 0;
      border-radius: 12px;
      max-width: 420px;
      margin: 0 15px;
      width: 100%;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
      overflow: hidden;
    }
    .mac-header {
      background: #2c2c2c;
      height: 32px;
      display: flex;
      align-items: center;
      padding: 0 12px;
    }
    .mac-buttons {
      display: flex;
      gap: 8px;
    }
    .mac-button {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
    }
    .mac-button.red {
      background: #ff605c;
    }
    .mac-button.yellow {
      background: #ffbd44;
    }
    .mac-button.green {
      background: #00ca4e;
    }
    #modalContent {
      padding: 25px 30px 30px;
      text-align: center;
    }
    #modalMessage {
      font-size: 17px;
      text-align: center;
      line-height: 1.5;
      margin: 20px 0;
      white-space: pre-wrap;
    }
    #modalConfirmBtn {
      background: #007aff;
      border: none;
      padding: 10px 24px;
      font-size: 15px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
      display: inline-block;
      margin-top: 10px;
    }
    #modalConfirmBtn:hover {
      background: #005bb5;
    }
  `;
  document.head.appendChild(style);

  const modalHTML = `
    <div id="customModal">
      <div>
        <div class="mac-header">
          <div class="mac-buttons">
            <span class="mac-button red"></span>
            <span class="mac-button yellow"></span>
            <span class="mac-button green"></span>
          </div>
        </div>
        <div id="modalContent">
          <div id="modalMessage"></div>
          <button id="modalConfirmBtn">ÌôïÏù∏</button>
        </div>
      </div>
    </div>
  `;
  document.body.insertAdjacentHTML('beforeend', modalHTML);

  const modal = document.getElementById('customModal');
  const msgElem = document.getElementById('modalMessage');
  const btn = document.getElementById('modalConfirmBtn');

  btn.addEventListener('click', () => {
    modal.classList.remove('show');
  });

  window.showCustomAlert = function (message) {
    if (!message) return;
    msgElem.textContent = message;
    modal.classList.add('show');
  };
})();
</script>


</body>
</html>
