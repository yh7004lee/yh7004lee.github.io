<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>ë§ì”€ ì†ë„ê²Œì„ ëª¨ë“œ</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'ë§‘ì€ ê³ ë”•', sans-serif;
      background-color: #121212;
      color: #f0f0f0;
      margin: 0;
      padding: 5px 20px;
      overflow-x: hidden;
    }

    h2, h3 {
      font-size: 1.2rem;
      text-align: left;
      color: #ffffff;
      margin-bottom: 10px;
    }

    p {
      text-align: center;
      margin-bottom: 20px;
      font-size: 1rem;
    }

    #word-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      padding: 10px;
      background-color: #1e1e1e;
      border: 2px dashed #888;
      border-radius: 12px;
      min-height: 100px;
     margin-bottom: 20px;
    }

    .word {
      font-size: 1.1rem;
      padding: 8px 10px;
      background-color: #2c2c2c;
      border: 2px solid #444;
      border-radius: 8px;
      cursor: pointer;
      user-select: none;
      color: #f0f0f0;
      transition: background-color 0.3s ease, color 0.3s ease;
      touch-action: manipulation;
      min-width: 50px;
      text-align: center;
    }

    .word.correct {
      background-color: #03dac6;
      color: #000;
      border-color: #03dac6;
      cursor: default;
    }

    .word.incorrect {
      animation: shake 0.3s;
      background-color: #ff5252;
      color: #fff;
      border-color: #ff5252;
    }

    @keyframes shake {
      0% { transform: translateX(0); }
      20% { transform: translateX(-6px); }
      40% { transform: translateX(6px); }
      60% { transform: translateX(-6px); }
      80% { transform: translateX(6px); }
      100% { transform: translateX(0); }
    }

    #result {
      margin-top: 20px;
      font-size: 1.3rem;
      font-weight: bold;
      text-align: center;
      min-height: 30px;
    }

    /* ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ */
    button {
      display: block;
      margin: 10px auto 0 auto;
      padding: 10px 0;
      font-size: 1.2rem;
      background-color: #444;
      color: #f0f0f0;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      width: 100%;
      box-sizing: border-box;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    button:hover:not(:disabled) {
      background-color: #666;
    }
    button:disabled {
      background-color: #222;
      cursor: default;
    }

  /* ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ */
#navButtons {
  display: flex;
  gap: 6px; /* ë²„íŠ¼ ì‚¬ì´ ê°„ê²© ì•½ê°„ ì¶•ì†Œ */
  margin-top: 6px; /* ìƒë‹¨ ì—¬ë°± ì¶•ì†Œ */
}
#navButtons .navBtn {
  flex: 1;
  padding: 4px 0;           /* ì„¸ë¡œ íŒ¨ë”© ì¶•ì†Œ */
  font-size: 0.85rem;       /* ê¸€ì í¬ê¸° ì¶•ì†Œ */
  background-color: #444;
  color: #f0f0f0;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  user-select: none;
  transition: background-color 0.3s ease;
  margin: 0;                /* ë¶ˆí•„ìš”í•œ ë§ˆì§„ ì œê±° */
}
    #navButtons .navBtn:hover {
      background-color: #666;
    }
    .navBtn.active {
      background-color: #03dac6 !important;
      color: #000000 !important;
      font-weight: bold;
    }
#verseTitle {
  margin: 10px 0 10px 0;
}
  </style>
</head>
<body>
  <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
  <div id="navButtons">
    <button class="navBtn" onclick="goToPrev()">ì´ì „</button>
    <button id="allVersesBtn" class="navBtn active">ëª¨ë‘</button>
    <button id="favVersesBtn" class="navBtn">ì¦ì°¾</button>
    <button class="navBtn" onclick="goToNext()">ë‹¤ìŒ</button>
  </div>

  <h3 id="verseTitle">ë§ì”€ ì œëª©</h3>


  <div id="word-container"></div>
  <p>í•œ ë‹¨ì–´ì”© ìˆœì„œëŒ€ë¡œ ë¹ ë¥´ê²Œ ëˆŒëŸ¬ë³´ì„¸ìš”!</p>
  <button id="restartBtn" style="display:none;">ğŸ”„ ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
  <button id="mainBtn">ğŸšï¸ ë§ì”€ì•”ì†¡ ë©”ì¸í™”ë©´</button>

  <div id="result"></div>

<script>
  const STORAGE_KEY_VERSES = 'savedVerses2';
  let allVerses = [];
  let verses = [];
  let currentStage = 0;
  let score = 0;

  const verseTitle = document.getElementById('verseTitle');
  const wordContainer = document.getElementById('word-container');
  const restartBtn = document.getElementById('restartBtn');
  const mainBtn = document.getElementById('mainBtn');
  const result = document.getElementById('result');
  const allVersesBtn = document.getElementById('allVersesBtn');
  const favVersesBtn = document.getElementById('favVersesBtn');

  let currentIndex = 0;  // í˜„ì¬ ëˆŒëŸ¬ì•¼ í•  ë‹¨ì–´ ì¸ë±ìŠ¤
  let currentWords = [];

  function loadVerses() {
    const saved = localStorage.getItem(STORAGE_KEY_VERSES);
    if (!saved) return [];

    try {
      const parsed = JSON.parse(saved);
      return parsed.map((v, i) => ({
        ...v,
        id: i,
        title: v.title || '',
        text: v.text || '',
        favorite: v.favorite || false
      }));
    } catch {
      return [];
    }
  }

  function shuffleArray(arr) {
    // Fisherâ€“Yates shuffle
    for (let i = arr.length -1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i +1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function renderStage() {
    if (currentStage >= verses.length) {
      verseTitle.textContent = 'ğŸ‰ ëª¨ë“  ìŠ¤í…Œì´ì§€ ì™„ë£Œ!';
      wordContainer.innerHTML = '';
      restartBtn.style.display = 'block';
      result.textContent = `ë‹¹ì‹ ì˜ ì ìˆ˜: ${score} / ${verses.length}`;
      return;
    }

    const verse = verses[currentStage];
    verseTitle.textContent = verse.title || `ìŠ¤í…Œì´ì§€ ${currentStage + 1}`;

    // ì •ë‹µ ë‹¨ì–´ ë°°ì—´
    const words = verse.text.trim().split(/\s+/).filter(word => !/^\[.*\]$/.test(word));
    currentWords = words;
    currentIndex = 0;
    result.textContent = '';
    restartBtn.style.display = 'none';

    // ë‹¨ì–´ë“¤ ì„ê¸°
    // í—·ê°ˆë¦¬ë„ë¡ ë‹¤ë¥¸ ëœë¤ ë‹¨ì–´ ëª‡ ê°œ ì¶”ê°€ (ì—¬ê¸°ì„  2ê°œ ì¶”ê°€)
const allWordsPool = allVerses.flatMap(v => v.text.trim().split(/\s+/));
const additionalWords = [];

while (additionalWords.length < 4) {
  const candidate = allWordsPool[Math.floor(Math.random() * allWordsPool.length)];
  if (!words.includes(candidate) && !additionalWords.includes(candidate) && !/^\[.*\]$/.test(candidate)) {
    additionalWords.push(candidate);
  }
}

const mixedWords = words.concat(additionalWords);
const shuffled = mixedWords.sort(() => Math.random() - 0.5);

    // ë‹¨ì–´ ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”
    wordContainer.innerHTML = '';
    shuffled.forEach(word => {
      const div = document.createElement('div');
      div.className = 'word';
      div.textContent = word;
      div.addEventListener('click', () => onWordClick(div, word));
      wordContainer.appendChild(div);
    });
  }

  function onWordClick(div, word) {
    if (div.classList.contains('correct')) return;  // ì´ë¯¸ ë§ì¶˜ ë‹¨ì–´

    if (word === currentWords[currentIndex]) {
      // ì •ë‹µ ë‹¨ì–´ í´ë¦­
      div.classList.add('correct');
      div.style.cursor = 'default';
      currentIndex++;
      result.textContent = `ì¢‹ì•„ìš”! ë‹¤ìŒ ë‹¨ì–´ë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”. (${currentIndex} / ${currentWords.length})`;
      result.style.color = '#03dac6';

      if (currentIndex === currentWords.length) {
        score++;
        result.textContent = 'ğŸ‰ ëª¨ë“  ë‹¨ì–´ë¥¼ ë§ì·„ìŠµë‹ˆë‹¤! ë‹¤ìŒ ìŠ¤í…Œì´ì§€ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤...';
        setTimeout(() => {
          currentStage++;
          renderStage();
        }, 1500);
      }
    } else {
      // ì˜¤ë‹µ
      div.classList.add('incorrect');
      result.textContent = 'âŒ í‹€ë ¸ì–´ìš”. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”!';
      result.style.color = '#ff5252';

      // ì§„ë™(ê°€ëŠ¥í•œ ê²½ìš°)
      if (navigator.vibrate) navigator.vibrate(100);

      setTimeout(() => div.classList.remove('incorrect'), 500);
    }
  }

  restartBtn.addEventListener('click', () => {
    currentStage = 0;
    score = 0;
    renderStage();
  });

  mainBtn.addEventListener('click', () => {
    location.href = 'index.html'; // ë©”ì¸ í™”ë©´ URL ë§ê²Œ ë³€ê²½í•˜ì„¸ìš”
  });

  function goToPrev() {
    if (currentStage > 0) {
      currentStage--;
      renderStage();
    }
  }

  function goToNext() {
    if (currentStage < verses.length - 1) {
      currentStage++;
      renderStage();
    }
  }

  allVersesBtn.addEventListener('click', () => {
    allVersesBtn.classList.add('active');
    favVersesBtn.classList.remove('active');
    verses = allVerses.slice();
    currentStage = 0;
    score = 0;
    renderStage();
  });

  favVersesBtn.addEventListener('click', () => {
    favVersesBtn.classList.add('active');
    allVersesBtn.classList.remove('active');
    verses = allVerses.filter(v => v.favorite);
    if (verses.length === 0) {
      wordContainer.innerHTML = '';
      verseTitle.textContent = 'ì¦ê²¨ì°¾ê¸°ëœ ë§ì”€ì´ ì—†ìŠµë‹ˆë‹¤.';
      result.textContent = '';
      restartBtn.style.display = 'none';
      return;
    }
    currentStage = 0;
    score = 0;
    renderStage();
  });

  // ì´ˆê¸° ë¡œë”©
  allVerses = loadVerses();
  verses = allVerses.slice();
  renderStage();
</script>
</body>
</html>
