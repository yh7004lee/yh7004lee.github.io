<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>말씀 속도게임 모드</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: '맑은 고딕', sans-serif;
      background-color: #121212;
      color: #f0f0f0;
      margin: 0;
      padding: 5px 20px;
      overflow-x: hidden;
    }

    h2, h3 {
      font-size: 1.2rem;
      text-align: left;
      color: #ffffff;
      margin-bottom: 10px;
    }

    p {
      text-align: center;
      margin-bottom: 20px;
      font-size: 1rem;
    }

    #word-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      padding: 10px;
      background-color: #1e1e1e;
      border: 2px dashed #888;
      border-radius: 12px;
      min-height: 100px;
     margin-bottom: 20px;
    }

    .word {
      font-size: 1.1rem;
      padding: 8px 10px;
      background-color: #2c2c2c;
      border: 2px solid #444;
      border-radius: 8px;
      cursor: pointer;
      user-select: none;
      color: #f0f0f0;
      transition: background-color 0.3s ease, color 0.3s ease;
      touch-action: manipulation;
      min-width: 50px;
      text-align: center;
    }

    .word.correct {
      background-color: #03dac6;
      color: #000;
      border-color: #03dac6;
      cursor: default;
    }

    .word.incorrect {
      animation: shake 0.3s;
      background-color: #ff5252;
      color: #fff;
      border-color: #ff5252;
    }

    @keyframes shake {
      0% { transform: translateX(0); }
      20% { transform: translateX(-6px); }
      40% { transform: translateX(6px); }
      60% { transform: translateX(-6px); }
      80% { transform: translateX(6px); }
      100% { transform: translateX(0); }
    }

    #result {
      margin-top: 20px;
      font-size: 1.3rem;
      font-weight: bold;
      text-align: center;
      min-height: 30px;
    }

    /* 버튼 공통 스타일 */
    button {
      display: block;
      margin: 10px auto 0 auto;
      padding: 10px 0;
      font-size: 1.2rem;
      background-color: #444;
      color: #f0f0f0;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      width: 100%;
      box-sizing: border-box;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    button:hover:not(:disabled) {
      background-color: #666;
    }
    button:disabled {
      background-color: #222;
      cursor: default;
    }

  /* 네비게이션 버튼 */
#navButtons {
  display: flex;
  gap: 6px; /* 버튼 사이 간격 약간 축소 */
  margin-top: 6px; /* 상단 여백 축소 */
}
#navButtons .navBtn {
  flex: 1;
  padding: 4px 0;           /* 세로 패딩 축소 */
  font-size: 0.85rem;       /* 글자 크기 축소 */
  background-color: #444;
  color: #f0f0f0;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  user-select: none;
  transition: background-color 0.3s ease;
  margin: 0;                /* 불필요한 마진 제거 */
}
    #navButtons .navBtn:hover {
      background-color: #666;
    }
    .navBtn.active {
      background-color: #03dac6 !important;
      color: #000000 !important;
      font-weight: bold;
    }
#verseTitle {
  margin: 10px 0 10px 0;
}
  </style>
</head>
<body>
  <!-- 상단 네비게이션 버튼 -->
  <div id="navButtons">
    <button class="navBtn" onclick="goToPrev()">이전</button>
    <button id="allVersesBtn" class="navBtn active">모두</button>
    <button id="favVersesBtn" class="navBtn">즐찾</button>
    <button class="navBtn" onclick="goToNext()">다음</button>
  </div>

  <h3 id="verseTitle">말씀 제목</h3>


  <div id="word-container"></div>
  <p>한 단어씩 순서대로 빠르게 눌러보세요!</p>
  <button id="restartBtn" style="display:none;">🔄 다시 시작하기</button>
  <button id="mainBtn">🏚️ 말씀암송 메인화면</button>

  <div id="result"></div>

<script>
  const STORAGE_KEY_VERSES = 'savedVerses2';
  let allVerses = [];
  let verses = [];
  let currentStage = 0;
  let score = 0;

  const verseTitle = document.getElementById('verseTitle');
  const wordContainer = document.getElementById('word-container');
  const restartBtn = document.getElementById('restartBtn');
  const mainBtn = document.getElementById('mainBtn');
  const result = document.getElementById('result');
  const allVersesBtn = document.getElementById('allVersesBtn');
  const favVersesBtn = document.getElementById('favVersesBtn');

  let currentIndex = 0;  // 현재 눌러야 할 단어 인덱스
  let currentWords = [];

  function loadVerses() {
    const saved = localStorage.getItem(STORAGE_KEY_VERSES);
    if (!saved) return [];

    try {
      const parsed = JSON.parse(saved);
      return parsed.map((v, i) => ({
        ...v,
        id: i,
        title: v.title || '',
        text: v.text || '',
        favorite: v.favorite || false
      }));
    } catch {
      return [];
    }
  }

  function shuffleArray(arr) {
    // Fisher–Yates shuffle
    for (let i = arr.length -1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i +1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function renderStage() {
    if (currentStage >= verses.length) {
      verseTitle.textContent = '🎉 모든 스테이지 완료!';
      wordContainer.innerHTML = '';
      restartBtn.style.display = 'block';
      result.textContent = `당신의 점수: ${score} / ${verses.length}`;
      return;
    }

    const verse = verses[currentStage];
    verseTitle.textContent = verse.title || `스테이지 ${currentStage + 1}`;

    // 정답 단어 배열
    const words = verse.text.trim().split(/\s+/).filter(word => !/^\[.*\]$/.test(word));
    currentWords = words;
    currentIndex = 0;
    result.textContent = '';
    restartBtn.style.display = 'none';

    // 단어들 섞기
    // 헷갈리도록 다른 랜덤 단어 몇 개 추가 (여기선 2개 추가)
const allWordsPool = allVerses.flatMap(v => v.text.trim().split(/\s+/));
const additionalWords = [];

while (additionalWords.length < 4) {
  const candidate = allWordsPool[Math.floor(Math.random() * allWordsPool.length)];
  if (!words.includes(candidate) && !additionalWords.includes(candidate) && !/^\[.*\]$/.test(candidate)) {
    additionalWords.push(candidate);
  }
}

const mixedWords = words.concat(additionalWords);
const shuffled = mixedWords.sort(() => Math.random() - 0.5);

    // 단어 컨테이너 초기화
    wordContainer.innerHTML = '';
    shuffled.forEach(word => {
      const div = document.createElement('div');
      div.className = 'word';
      div.textContent = word;
      div.addEventListener('click', () => onWordClick(div, word));
      wordContainer.appendChild(div);
    });
  }

  function onWordClick(div, word) {
    if (div.classList.contains('correct')) return;  // 이미 맞춘 단어

    if (word === currentWords[currentIndex]) {
      // 정답 단어 클릭
      div.classList.add('correct');
      div.style.cursor = 'default';
      currentIndex++;
      result.textContent = `좋아요! 다음 단어를 눌러보세요. (${currentIndex} / ${currentWords.length})`;
      result.style.color = '#03dac6';

      if (currentIndex === currentWords.length) {
        score++;
        result.textContent = '🎉 모든 단어를 맞췄습니다! 다음 스테이지로 넘어갑니다...';
        setTimeout(() => {
          currentStage++;
          renderStage();
        }, 1500);
      }
    } else {
      // 오답
      div.classList.add('incorrect');
      result.textContent = '❌ 틀렸어요. 다시 시도하세요!';
      result.style.color = '#ff5252';

      // 진동(가능한 경우)
      if (navigator.vibrate) navigator.vibrate(100);

      setTimeout(() => div.classList.remove('incorrect'), 500);
    }
  }

  restartBtn.addEventListener('click', () => {
    currentStage = 0;
    score = 0;
    renderStage();
  });

  mainBtn.addEventListener('click', () => {
    location.href = 'index.html'; // 메인 화면 URL 맞게 변경하세요
  });

  function goToPrev() {
    if (currentStage > 0) {
      currentStage--;
      renderStage();
    }
  }

  function goToNext() {
    if (currentStage < verses.length - 1) {
      currentStage++;
      renderStage();
    }
  }

  allVersesBtn.addEventListener('click', () => {
    allVersesBtn.classList.add('active');
    favVersesBtn.classList.remove('active');
    verses = allVerses.slice();
    currentStage = 0;
    score = 0;
    renderStage();
  });

  favVersesBtn.addEventListener('click', () => {
    favVersesBtn.classList.add('active');
    allVersesBtn.classList.remove('active');
    verses = allVerses.filter(v => v.favorite);
    if (verses.length === 0) {
      wordContainer.innerHTML = '';
      verseTitle.textContent = '즐겨찾기된 말씀이 없습니다.';
      result.textContent = '';
      restartBtn.style.display = 'none';
      return;
    }
    currentStage = 0;
    score = 0;
    renderStage();
  });

  // 초기 로딩
  allVerses = loadVerses();
  verses = allVerses.slice();
  renderStage();
</script>
</body>
</html>
