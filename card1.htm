<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>í€´ì¦ˆ ì¹´ë“œ</title>
 <link rel="stylesheet" href="quiz-style.css" />
</head>
<body>

<div class="top-bar-wrapper">
  <div class="top-bar">
    <div class="hamburger" onclick="toggleMenu()">
      <span></span><span></span><span></span>
    </div>
    <div class="right-icons">


<svg id="game-icon" viewBox="0 0 26 26" fill="none" stroke="none">
  <g transform="translate(2.6 1.2) scale(1.3 1.5)">
    <!-- ì¢Œìš° ëŒ€ì¹­ ì¡°ì´ìŠ¤í‹± ì™¸ê³½ -->
    <path
      fill="#000000"
      d="
        M0 13
        Q1.5 14.5, 4 13
        L6.5 10.5
        H9.5
        L12 13
        Q14.5 14.5, 16 13
        L15.2 4.8
        Q15 2.8, 12.3 2
        H3.7
        Q1 2.8, 0.8 4.8
        L0 13
        Z
      "
    />

    <!-- ì™¼ìª½ + ê¸°í˜¸ (ì‚´ì§ ì•„ë˜ë¡œ) -->
    <line x1="2.25" y1="6.8" x2="6.75" y2="6.8" stroke="#ffffff" stroke-width="1.5" stroke-linecap="butt"/>
    <line x1="4.5"  y1="4.8" x2="4.5"  y2="8.8" stroke="#ffffff" stroke-width="1.5" stroke-linecap="butt"/>

    <!-- ì˜¤ë¥¸ìª½ í° ë²„íŠ¼ (ì‚´ì§ ì•„ë˜ë¡œ) -->
    <circle cx="11.5" cy="6.8" r="2" fill="#ffffff"/>
  </g>
</svg>




<!-- ì£¼ì‚¬ìœ„ ì•„ì´ì½˜ -->
<svg id="random-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" 
  style="fill:none;" >
  <g transform="translate(2.4 2.4) scale(0.82)">
    <rect x="2" y="2" width="20" height="20" rx="3" ry="3" fill="none"/>
    <circle cx="12" cy="12" r="1" fill="currentColor"/>
    <circle cx="7"  cy="7"  r="1" fill="currentColor"/>
    <circle cx="17" cy="7"  r="1" fill="currentColor"/>
    <circle cx="7"  cy="17" r="1" fill="currentColor"/>
    <circle cx="17" cy="17" r="1" fill="currentColor"/>
  </g>
</svg>




<!-- ìœ ë ¹ ì•„ì´ì½˜ -->
<svg id="ghost-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path d="M4.8 10
           a7.2 7.2 0 1 1 14.4 0v10
           c0 .3-.3.5-.6.3
           l-2.2-1.5-2.2 1.5-2.2-1.5-2.2 1.5-2.2-1.5-2.2 1.5
           c-.3.2-.6 0-.6-.3V10z"
        fill="currentColor" stroke="none"/>
<circle cx="9.5" cy="11" r="2.2" fill="var(--bg-color)"/>
<circle cx="14.5" cy="11" r="2.2" fill="var(--bg-color)"/>
</svg>

<!-- ë¶ë§ˆí¬ ì•„ì´ì½˜ -->
<svg id="bookmark-icon" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path d="M6 4h12a1 1 0 0 1 1 1v14.5a0.5 0.5 0 0 1-0.8 0.4L12 13.3l-6.2 6.6a0.5 0.5 0 0 1-0.8-0.4V5a1 1 0 0 1 1-1z" />
</svg>

<!-- ë‹¤í¬ëª¨ë“œ ì•„ì´ì½˜ -->
<svg id="dark-icon" viewBox="0 0 24 24" stroke-width="2"  >
  <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 1 0 9.79 9.79z"/>
</svg>

<svg id="light-icon" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
  <circle cx="12" cy="12" r="5"/>
  <line x1="12" y1="1" x2="12" y2="3"/>
  <line x1="12" y1="21" x2="12" y2="23"/>
  <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
  <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
  <line x1="1" y1="12" x2="3" y2="12"/>
  <line x1="21" y1="12" x2="23" y2="12"/>
  <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
  <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
</svg>


<!-- ì„¤ì • ì•„ì´ì½˜ -->
<svg class="settings-icon" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" 
     onclick="toggleSettingsMenu()" style="cursor:pointer; width:28px; height:28px;">
  <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
  <circle cx="12" cy="12" r="3"/>
</svg>
    </div>
  </div>
</div>


<div class="menu-wrapper">
  <div class="menu" id="menu">
    <!-- ë©”ë‰´ ì•„ì´í…œ JSë¡œ ì±„ì›€ -->
  </div>
</div>


<!-- ì„¤ì • ë©”ë‰´ -->
<div class="menu-wrapper">
  <div class="menu" id="settings-menu">
<!-- ê¸€ì ì‚¬ì´ì¦ˆ ë¼ë²¨ê³¼ ìŠ¬ë¼ì´ë” í†µí•© -->
<div class="menu-item slider-setting">
<label for="fontSlider" id="fontSizeLabel">ê¸€ì í¬ê¸° ì¡°ì ˆ</label>
  <input type="range" id="fontSlider" min="0" max="6" value="2" step="1">
</div>
    <div onclick="resetFontSize()">ê¸€ìì‚¬ì´ì¦ˆ ì´ˆê¸°í™”</div>
    <div onclick="createCustomCard()">ì•”ê¸°ì¹´ë“œ ë°±ì—… ë³µì›</div>
    <div onclick="openCardEditorPopup()">ì•”ê¸°ì¹´ë“œ ì¶”ê°€ í¸ì§‘</div>
    <div onclick="showHelp()">ë„ì›€ë§</div>
    <div onclick="exitApp(); closeSettingsMenu();" style="color: rgb(255, 68, 68); font-weight: 600;">ë‚˜ê°€ê¸°</div>
  </div>
</div>



<div  class="content" id="content">
<div class="card title-card font-adjust" id="title-box"></div>
<div class="card question font-adjust" id="question-box"></div>
<div class="card answer font-adjust" id="answer-box"></div>

  <!-- ì¦ê²¨ì°¾ê¸° ì¹´ë“œ ì¶”ê°€ -->
  <div id="bookmark-wrapper" class="card favorite-card">
    
<label class="favorite-label font-adjust" style="display: inline-flex; align-items: center; gap: 12px; cursor: pointer;">
  ì¦ê²¨ì°¾ê¸° ì¶”ê°€
  <input type="checkbox" id="bookmark-checkbox" style="width: 1.2em; height: 1.2em; vertical-align: middle; accent-color: #ff6f61;">
</label>
        
  </div>

   <div id="game-buttons" class="button-group">
      <button id="hint-btn">íŒíŠ¸ ë³´ê¸°</button>
      <button id="check-btn">ì •ë‹µ í™•ì¸</button>
    </div>

</div>






<div id="tooltip" style="
  position: fixed;
  top: 60px;
  left: 50%;
  transform: translateX(-50%) scale(0.95);
  background: linear-gradient(135deg, #5a4de6, #8c77ff);
  color: #fff;
  padding: 10px 16px;
  border-radius: 8px;
  font-size: 1.1rem;
  font-weight: 500;
  z-index: 9999;
  display: none;
  opacity: 0;
  transition: opacity 0.3s ease, transform 0.3s ease;
  white-space: normal;
  max-width: 350px;
  box-sizing: border-box;
  text-align: center;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
  pointer-events: none;
  text-shadow: 0 1px 2px rgba(0,0,0,0.3);
  word-break: break-word;

"></div>

<!-- ğŸ”µ ë§¥ ìŠ¤íƒ€ì¼ íŒì—… -->
<div class="mac-popup" id="cardEditorPopup" style="display:none">
  <div class="mac-popup-inner"  style="box-shadow: 0 0 10px rgba(0,255,255,0.5), 0 0 20px rgba(0,255,255,0.7), 0 0 40px rgba(0,255,255,0.9); border-radius: 16px; ">
  <div class="mac-popup-header">
    <!-- ë§¥ ìŠ¤íƒ€ì¼ ì›í˜• ë²„íŠ¼ 3ê°œ -->
    <div class="mac-window-controls">
      <span class="mac-btn mac-close"></span>
      <span class="mac-btn mac-minimize"></span>
      <span class="mac-btn mac-maximize"></span>
    </div>
    <span class="mac-popup-title">ì•”ê¸°ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ í¸ì§‘</span>
    <button class="mac-popup-close" onclick="closeCardEditorPopup()">&#10005;</button>
  </div>
  <div class="mac-popup-body">
  <div class="popup-label">í¸ì§‘í•  ì•”ê¸°ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>
  <select id="cardSelector" onchange="onCardTitleChange()" 
    style="appearance: auto; -webkit-appearance: auto; -moz-appearance: auto; width: 100%; padding: 6px 24px 6px 8px; font-size: 16px; 
    background-color: #1e1e1e; color: #aaa; border: 1px solid #444;">
  </select>

  <div class="title-edit-section" style="display: flex; gap: 6px; align-items: center;">
    <div style="pointer-events: none; background-color: #2a2a2a; color: #ccc; border: 1px solid #444; border-radius: 6px; padding: 4px 10px; font-size: 14px; height: 25px; display: flex; align-items: center;">
      ì œëª© : 
    </div>
    <input type="text" id="cardTitleInput" style="flex: 1; padding: 4px 10px; font-size: 14px; border: 1px solid #444; border-radius: 6px; background-color: #1e1e1e; color: #aaa; height: 25px;"
      value="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
      onfocus="if(this.value==='ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”'){this.value=''; this.style.color='#eee';}"
      onblur="if(this.value===''){this.value='ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”'; this.style.color='#aaa';}">
  </div>

  <textarea id="cardEditorTextarea" rows="8" 
    style="width: 100%; padding: 8px; font-size: 14px; background-color: #1e1e1e; color: #aaa; border: 1px solid #444; border-radius: 6px;">
  </textarea>

    <div class="editor-buttons">
      
  <button onclick="applyCardChanges()">ì ìš©</button>
  <button onclick="prepareNewCard()">ìƒˆ ì¹´ë“œ </button>
  <button onclick="deleteSelectedCard()">ì‚­ì œ</button> <!-- ğŸ”´ ì¶”ê°€ -->
    </div>

<div class="editor-buttons2" style="display: flex; gap: 10px; margin-top: 12px;">
  <button onclick="resetToInitialData()">ì´ˆê¸°í™”</button>
  <button onclick="backupQuizData()">ë°±ì—…</button>
  <button onclick="restoreFromFile()">ë³µêµ¬</button>
</div>

 </div> </div>
</div>

<script src="fireworks.js"></script>
<script src="quizData.js"></script>
<script src="tooltip.js"></script>
<script src="swipeHandler.js"></script>
<script src="fontSizeControl.js"></script>
<script>

const menu = document.getElementById('menu');
const questionBox = document.getElementById('question-box');
const answerBox = document.getElementById('answer-box');
const titleBox = document.getElementById('title-box');
const bookmarkCheckbox = document.getElementById('bookmark-checkbox');
const bookmarkIcon = document.getElementById('bookmark-icon');
const ghostIcon = document.getElementById('ghost-icon');
const randomIcon = document.getElementById('random-icon');
const darkIcon = document.getElementById('dark-icon');
const lightIcon = document.getElementById('light-icon');
const content = document.getElementById('content');

let currentCategory = null;
let currentIndex = 0;
let categories = Object.keys(quizData);
let ghostMode = false;    // ë‹µë³€ ìˆ¨ê¹€ ëª¨ë“œ
let randomMode = false;   // ëœë¤ ìŠ¤ì™€ì´í”„ ëª¨ë“œ
let favoriteFilter = false; // ì¦ê²¨ì°¾ê¸° í•„í„° ëª¨ë“œ
let favorites = new Set();  // ì¦ê²¨ì°¾ê¸° ë¬¸ì œ ì¸ë±ìŠ¤ ì €ì¥, ì—¬ê¸°ì„œëŠ” ì¸ë±ìŠ¤ ë²ˆí˜¸ ëŒ€ì‹  ê³ ìœ í‚¤ ì‚¬ìš© ì˜ˆì •

// 1. ë©”ë‰´ ìƒì„± ë° ì„ íƒ ê¸°ëŠ¥
function createMenu() {
  menu.innerHTML = '';
  categories.forEach(cat => {
    const div = document.createElement('div');
    div.textContent = cat;
    div.onclick = () => {
      currentCategory = cat;
      currentIndex = 0;

  // ğŸ”½ ì—¬ê¸° ì¶”ê°€!
  gameMode = false;
  gameIcon.classList.remove('active'); // ì•„ì´ì½˜ ìƒíƒœ ì´ˆê¸°í™”
  document.getElementById('game-buttons').style.display = 'none';
  document.getElementById('bookmark-wrapper').style.display = 'flex';

      ghostMode = false;
      randomMode = false;
      favoriteFilter = false;
      updateIconsState();
      bookmarkCheckbox.checked = false;
      showMenu(false);
      renderCard();
      saveStatesToStorage();
    };
    menu.appendChild(div);
  });

  // ë‚˜ê°€ê¸° ë²„íŠ¼ ì¶”ê°€
  const exitBtn = document.createElement('div');
  exitBtn.textContent = 'ë‚˜ê°€ê¸°';
  exitBtn.style.color = '#ff4444';
  exitBtn.style.fontWeight = 'bold';
  exitBtn.onclick = () => {
    showMenu(false);
  };
  menu.appendChild(exitBtn);
}


// ë©”ë‰´ ë³´ì´ê¸°/ìˆ¨ê¸°ê¸° í† ê¸€
function toggleMenu() {
  const isShown = menu.classList.contains('show');

  if (isShown) {
    menu.classList.remove('show');
    document.removeEventListener('click', outsideMenuClickHandler);
  } else {
    menu.classList.add('show');
    setTimeout(() => {
      document.addEventListener('click', outsideMenuClickHandler);
    }, 0);
  }
}
function outsideMenuClickHandler(e) {
  const hamburger = document.querySelector('.hamburger');
  if (!menu.contains(e.target) && !hamburger.contains(e.target)) {
    menu.classList.remove('show');
    document.removeEventListener('click', outsideMenuClickHandler);
  }
}
// 2. ì¹´ë“œ ë Œë”ë§ í•¨ìˆ˜
function renderCard() {
  if (!currentCategory) return;
  const data = quizData[currentCategory];

  // ì¦ê²¨ì°¾ê¸° í•„í„°ê°€ ì¼œì ¸ ìˆìœ¼ë©´ ì¦ê²¨ì°¾ê¸°ë§Œ í•„í„°ë§
  let filteredData = data;
  if (favoriteFilter) {
    filteredData = data.filter((item, idx) => favorites.has(getKey(currentCategory, idx)));
    if(filteredData.length === 0){
      questionBox.textContent = 'ì¦ê²¨ì°¾ê¸°ëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.';
      answerBox.textContent = '';
      titleBox.textContent = (currentCategory ? 'ğŸ¯ ' + currentCategory : '');
      return;
    }
  }

if (randomMode) {
  if (shufflePointer >= shuffledIndices.length) {
    initShuffledIndices();  // ë‹¤ì‹œ ì…”í”Œ
  }
  currentIndex = shuffledIndices[shufflePointer];
} else {
  // ìˆœì°¨ ì¸ë±ìŠ¤ ë³´ì •
  if (currentIndex >= filteredData.length) currentIndex = 0;
  else if (currentIndex < 0) currentIndex = filteredData.length - 1;
}

  const card = filteredData[currentIndex];
  titleBox.textContent = (currentCategory ? 'ğŸ¯ ' + currentCategory : '');
  const realIndex = getRealIndex(currentIndex);
  questionBox.textContent = (realIndex + 1) + '. ' + card.Q;
  if (ghostMode) {
    // ë‹µë³€ ìˆ¨ê¹€ ì²˜ë¦¬
    answerBox.classList.add('hidden');
  } else {
    answerBox.classList.remove('hidden');
    answerBox.textContent = card.A;
  }
  // ì²´í¬ë°•ìŠ¤ ë™ê¸°í™”
  const key = getKey(currentCategory, getRealIndex(currentIndex));
  bookmarkCheckbox.checked = favorites.has(key);
}

// ì¦ê²¨ì°¾ê¸° ì²´í¬ë°•ìŠ¤ í´ë¦­ ì²˜ë¦¬
bookmarkCheckbox.addEventListener('change', () => {
  if (!currentCategory) return;
  const realIndex = getRealIndex(currentIndex);
  const key = getKey(currentCategory, realIndex);

  if (bookmarkCheckbox.checked) {
    favorites.add(key);
  } else {
    favorites.delete(key);

    // ì¦ê²¨ì°¾ê¸° ëª¨ë“œ ì¤‘ì¸ë°, í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ì¦ê²¨ì°¾ê¸°ê°€ 0ê°œê°€ ë˜ë©´ í•„í„° í•´ì œ
    const hasFavorites = Array.from(favorites).some(k => k.startsWith(currentCategory + '_'));
    if (favoriteFilter && !hasFavorites) {
      favoriteFilter = false;
      showTooltip('ì¦ê²¨ì°¾ê¸° í•­ëª©ì´ ì—†ì–´ í•„í„° ëª¨ë“œê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      updateIconsState();
    }
  }

  saveStatesToStorage();
  renderCard();
});
// í˜„ì¬ ë³´ì—¬ì§€ëŠ” ì¹´ë“œì˜ ì‹¤ì œ ì¸ë±ìŠ¤ ì°¾ê¸° (í•„í„°ë§ ë•Œë¬¸ì— ë‹¬ë¼ì§)
function getRealIndex(currentFilteredIndex) {
  if (!favoriteFilter) return currentFilteredIndex;
  const data = quizData[currentCategory];
  // favoriteFilter = trueë¼ë©´ í•„í„°ë§ëœ ì¸ë±ìŠ¤ -> ì›ë³¸ ì¸ë±ìŠ¤ ë³€í™˜ í•„ìš”
  const filteredIndices = [];
  for(let i=0; i<data.length; i++) {
    if(favorites.has(getKey(currentCategory, i))) filteredIndices.push(i);
  }
  return filteredIndices[currentFilteredIndex] ?? 0;
}

// ì¹´í…Œê³ ë¦¬ + ì¸ë±ìŠ¤ ë¬¸ìì—´ í‚¤ ìƒì„±
function getKey(category, index) {
  return category + '_' + index;
}

// 3. ì•„ì´ì½˜ ìƒíƒœ ì—…ë°ì´íŠ¸ (ìƒ‰ìƒ í™œì„±í™” ë°˜ì˜)
function updateIconsState() {
  // ë‹¤í¬ëª¨ë“œ
  if (document.body.classList.contains('dark')) {
    darkIcon.style.display = 'none';
    lightIcon.style.display = 'inline';
  } else {
    darkIcon.style.display = 'inline';
    lightIcon.style.display = 'none';
  }
  // ì¦ê²¨ì°¾ê¸° ì•„ì´ì½˜ í™œì„±í™” ì—¬ë¶€ (ì¦ê²¨ì°¾ê¸° í•„í„° ì¼œì§)
  if (favoriteFilter) bookmarkIcon.classList.add('active');
  else bookmarkIcon.classList.remove('active');
  // ìœ ë ¹ ì•„ì´ì½˜ í™œì„±í™” ì—¬ë¶€ (ë‹µë³€ ìˆ¨ê¹€)
  if (ghostMode) ghostIcon.classList.add('active');
  else ghostIcon.classList.remove('active');
  // ëœë¤ ëª¨ë“œ ì•„ì´ì½˜ í™œì„±í™” ì—¬ë¶€
  if (randomMode) randomIcon.classList.add('active');
  else randomIcon.classList.remove('active');
}

// 4. ë‹¤í¬ëª¨ë“œ í† ê¸€ í•¨ìˆ˜
function toggleDarkMode() {
  document.body.classList.toggle('dark');
  updateIconsState();
  // ìƒíƒœ ì €ì¥
  localStorage.setItem('darkMode', document.body.classList.contains('dark') ? '1' : '0');
}

// 5. ìœ ë ¹ ëª¨ë“œ í† ê¸€ (ë‹µë³€ ìˆ¨ê¹€/ë³´ì„)
function toggleGhostMode() {
  ghostMode = !ghostMode;
  updateIconsState();
  renderCard();
  setTimeout(() => {
    showTooltip(ghostMode ? 'ì •ë‹µì´ ìˆ¨ê²¨ì¡ŒìŠµë‹ˆë‹¤.' : 'ì •ë‹µì´ í‘œì‹œë©ë‹ˆë‹¤.');
  }, 10); // renderCard í›„ íˆ´íŒ ì¶œë ¥ íƒ€ì´ë°ì„ ë³´ì¥
}
// 6. ëœë¤ ëª¨ë“œ í† ê¸€ (ìŠ¤ì™€ì´í”„ ëª¨ë“œ ì „í™˜)

let shuffledIndices = [];   // ëœë¤ ìˆœì„œ ë°°ì—´
let shufflePointer = 0;     // í˜„ì¬ ì¸ë±ìŠ¤ ìœ„ì¹˜

function toggleRandomMode() {
  const cardCount = getFilteredLength();
  if (cardCount <= 2) {
    showTooltip('ì§€ê¸ˆ ì¹´ë“œì˜ ìˆ«ìê°€ 2ê°œ ì´í•˜ë¼ì„œ ëœë¤ëª¨ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    return;
  }

  randomMode = !randomMode;
  updateIconsState();

  if (randomMode) {
    initShuffledIndices(); // ëœë¤ ëª¨ë“œ ì¼¤ ë•Œ ì´ˆê¸°í™”
    showTooltip('ëœë¤ ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
  } else {
    showTooltip('ìˆœì°¨ ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
  }
}

function initShuffledIndices() {
  const count = getFilteredLength();
  shuffledIndices = Array.from({ length: count }, (_, i) => i);

  // Fisher-Yates Shuffle
  for (let i = shuffledIndices.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffledIndices[i], shuffledIndices[j]] = [shuffledIndices[j], shuffledIndices[i]];
  }

  shufflePointer = 0;
}

// 7. ì¦ê²¨ì°¾ê¸° í•„í„° í† ê¸€ (ë¶ë§ˆí¬ ì•„ì´ì½˜ í´ë¦­)
function toggleBookmarkMode() {
  if (!favoriteFilter) {
    // í•„í„°ë¥¼ ì¼œë ¤ê³  í•  ë•Œ ì¦ê²¨ì°¾ê¸° í•­ëª©ì´ ì•„ì˜ˆ ì—†ìœ¼ë©´ ì°¨ë‹¨
    if (favorites.size === 0) {
      showTooltip('ì¦ê²¨ì°¾ê¸° ì¶”ê°€ëœ ì¹´ë“œê°€ í•˜ë‚˜ë„ ì—†ìŠµë‹ˆë‹¤.');
      return;
    }

    // í˜„ì¬ ì¹´í…Œê³ ë¦¬ì— í•´ë‹¹í•˜ëŠ” ì¦ê²¨ì°¾ê¸° í•­ëª©ì´ ì—†ìœ¼ë©´ ì°¨ë‹¨
    const data = quizData[currentCategory];
    const hasFavorites = data.some((item, idx) => favorites.has(getKey(currentCategory, idx)));
    if (!hasFavorites) {
      showTooltip('ì¦ê²¨ì°¾ê¸° ì¶”ê°€ëœ ì¹´ë“œê°€ í•˜ë‚˜ë„ ì—†ìŠµë‹ˆë‹¤.');
      return;
    }

    // ğŸ¯ ëœë¤ëª¨ë“œê°€ ì¼œì ¸ ìˆëŠ”ë° ì¦ê²¨ì°¾ê¸° í•­ëª©ì´ 2ê°œ ì´í•˜ì¸ ê²½ìš° ìë™ í•´ì œ
    const filtered = data.filter((item, idx) => favorites.has(getKey(currentCategory, idx)));
    if (randomMode && filtered.length <= 2) {
      randomMode = false;
      updateIconsState();
      showTooltip('ì¦ê²¨ì°¾ê¸° ì¹´ë“œ ìˆ˜ê°€ ë¶€ì¡±í•˜ì—¬ ëœë¤ëª¨ë“œê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
  }

  favoriteFilter = !favoriteFilter;
  updateIconsState();
  showTooltip(favoriteFilter ? 'ì¦ê²¨ì°¾ê¸° ì¶”ê°€ëœ ì¹´ë“œë§Œ ë…¸ì¶œë©ë‹ˆë‹¤.' : 'ì „ì²´ ì¹´ë“œê°€ ë…¸ì¶œë©ë‹ˆë‹¤.');
  currentIndex = 0;  // í•„í„° ë³€ê²½ì‹œ ì¸ë±ìŠ¤ ì´ˆê¸°í™”
  renderCard();
}



// í•„í„°ë§ ì ìš© í›„ ê¸¸ì´ ë°˜í™˜
function getFilteredLength() {
  if (!currentCategory) return 0;
  let data = quizData[currentCategory];
  if (favoriteFilter) {
    data = data.filter((item, idx) => favorites.has(getKey(currentCategory, idx)));
  }
  return data.length;
}
// 9. ìƒíƒœ ë¡œì»¬ ì €ì¥ / ë³µì›
function saveStatesToStorage() {
  // ì¦ê²¨ì°¾ê¸° ëª©ë¡ ì €ì¥(ë¬¸ìì—´ë¡œ)
  localStorage.setItem('favorites', JSON.stringify(Array.from(favorites)));

  // ë‹¤í¬ëª¨ë“œ ì €ì¥ (ì´ë¯¸ ìœ„ toggleDarkModeì—ì„œ ì €ì¥ ì¤‘)

  // í˜„ì¬ ì¹´í…Œê³ ë¦¬ ì €ì¥
  localStorage.setItem('currentCategory', currentCategory || '');

  // ì¦ê²¨ì°¾ê¸° í•„í„° ì €ì¥
  localStorage.setItem('favoriteFilter', favoriteFilter ? '1' : '0');
}

// ì¦ê²¨ì°¾ê¸° ë³µì›
function loadFavoritesFromStorage() {
  const favs = localStorage.getItem('favorites');
  if (favs) {
    try {
      const arr = JSON.parse(favs);
      favorites = new Set(arr);
    } catch {
      favorites = new Set();
    }
  }
}

// ì „ì²´ ìƒíƒœ ë³µì›
function loadStatesFromStorage() {
  // ğŸ”½ ì¶”ê°€: ì „ì²´ ì¹´ë“œ ë³µì›
  const savedAll = localStorage.getItem('allQuizData');
  if (savedAll) {
    try {
      const parsed = JSON.parse(savedAll);
      Object.assign(quizData, parsed); // ê¸°ì¡´ quizData ë®ì–´ì“°ê¸°
      categories = Object.keys(quizData);
    } catch(e) {
      console.warn('quizData ë³µì› ì‹¤íŒ¨:', e);
    }
  }

  // ê¸°ì¡´ ìƒíƒœ ë³µì› ë¡œì§ ê³„ì†...
  const dark = localStorage.getItem('darkMode');
  if (dark === '1') document.body.classList.add('dark');
  else document.body.classList.remove('dark');

  loadFavoritesFromStorage();

  const savedCat = localStorage.getItem('currentCategory');
  currentCategory = (savedCat && categories.includes(savedCat)) ? savedCat : categories[0];

  favoriteFilter = false;
  ghostMode = false;
  randomMode = false;

  updateIconsState();
  renderCard();
  bookmarkCheckbox.checked = favoriteFilter;
}

// 10. ì•„ì´ì½˜ í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²°
darkIcon.onclick = () => {
  toggleDarkMode();
  saveStatesToStorage();
};
lightIcon.onclick = () => {
  toggleDarkMode();
  saveStatesToStorage();
};

bookmarkIcon.onclick = () => {
  toggleBookmarkMode();
  saveStatesToStorage();
};

randomIcon.onclick = () => {
  toggleRandomMode();
  saveStatesToStorage();
};

ghostIcon.onclick = () => {
  if (gameMode) {
    showTooltip("ê²Œì„ëª¨ë“œì—ì„œëŠ” ìœ ë ¹ëª¨ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  ghostMode = !ghostMode;
  updateIconsState();

  // íˆ´íŒ ë¨¼ì € ë„ì›€ (renderCardë³´ë‹¤ ë¨¼ì €)
  setTimeout(() => {
    showTooltip(ghostMode ? "ì •ë‹µì´ ìˆ¨ê²¨ì¡ŒìŠµë‹ˆë‹¤." : "ì •ë‹µì´ í‘œì‹œë©ë‹ˆë‹¤.");
  }, 10);

  renderCard();
};
// 11. í˜ì´ì§€ ì´ˆê¸°í™”
loadStatesFromStorage();
createMenu();


// ë©”ë‰´ ì²˜ìŒì— í‘œì‹œ
showMenu(false);

// ë©”ë‰´ í‘œì‹œ/ìˆ¨ê¸°ê¸° í•¨ìˆ˜
function showMenu(show) {
  if (show) menu.classList.add('show');
  else menu.classList.remove('show');
}

//ê¸€ì í¬ê¸° ì¡°ì •

//ê²Œì„í´ë¦­
const hintBtn = document.getElementById('hint-btn');
const checkBtn = document.getElementById('check-btn');
const gameIcon = document.getElementById('game-icon');
let gameMode = false;

// ê²Œì„ ì•„ì´ì½˜ í´ë¦­ ì´ë²¤íŠ¸
gameIcon.onclick = () => {
  gameMode = !gameMode;

  if (gameMode) {
    showTooltip("ê²Œì„ëª¨ë“œë¡œ ë³€ê²½í•©ë‹ˆë‹¤.");
    gameIcon.classList.add('active');

    // âœ… ìœ ë ¹ëª¨ë“œ ìë™ í•´ì œ
    if (ghostMode) {
      ghostMode = false;
      updateIconsState();  // ì•„ì´ì½˜ ìƒíƒœ ë°˜ì˜
      setTimeout(() => {
        showTooltip("ê²Œì„ëª¨ë“œë¡œ ì „í™˜ë˜ë©° ìœ ë ¹ëª¨ë“œê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
      }, 10);  // íˆ´íŒì´ ë®ì–´ì”Œì›Œì§€ì§€ ì•Šë„ë¡ ì•½ê°„ ì§€ì—°
    }

  } else {
    showTooltip("ê²Œì„ëª¨ë“œë¥¼ í•´ì œí•©ë‹ˆë‹¤.");
    gameIcon.classList.remove('active');

    // ğŸŸ¡ ê²Œì„ëª¨ë“œ í•´ì œ ìƒíƒœì—ì„œ ìœ ë ¹ëª¨ë“œê°€ êº¼ì ¸ ìˆìœ¼ë©´, ìœ ë ¹ëª¨ë“œ íˆ´íŒì´ ë‹¤ìŒ í´ë¦­ ì‹œ ì˜ ë‚˜ì˜¤ê²Œ ì¤€ë¹„ë¨
  }

  const gameButtons = document.getElementById('game-buttons');
  if (gameButtons) {
    gameButtons.style.display = gameMode ? 'flex' : 'none';
  }

  // const bookmarkWrap = document.getElementById('bookmark-wrapper');
  // if (bookmarkWrap) {
  // bookmarkWrap.style.display = gameMode ? 'none' : 'flex';
  // }

  updateIconsState();  // ì•„ì´ì½˜ ìƒíƒœ ë™ê¸°í™”
  renderCard();  // ì¹´ë“œ ë‹¤ì‹œ ê·¸ë¦¼
};


// ì •ë‹µ ë°•ìŠ¤ì—ì„œ ì¸í’‹ìœ¼ë¡œ ë°”ê¿”ì¤„ ë‹¨ì–´ë¥¼ ì„ íƒ
function convertAnswerToInputs(answer) {
  const words = answer.split(/\s+/);
  const indexes = [];

  for (let i = 0; i < words.length; i++) {
    const clean = words[i].replace(/[^\p{L}\p{N}]/gu, '');
    if (clean.length > 1) indexes.push(i);
  }

  const selected = indexes.sort(() => 0.5 - Math.random()).slice(0, 3);

  return words.map((word, idx) => {
    if (selected.includes(idx)) {
      const punctuation = word.match(/[.,!?]$/);
      const cleanWord = word.replace(/[.,!?]/g, '');

      return `
        <span class="answer-wrapper">
          <input type="text" class="answer-input" data-answer="${cleanWord}" autocomplete="off" />
          <span class="hint-text"></span>
        </span>
        ${punctuation ? punctuation[0] : ''}
      `;
    } else {
      return `<span class="answer-label">${word}</span>`;
    }
  }).join(' ');
}
// íŒíŠ¸ ë³´ê¸° ê¸°ëŠ¥

function getChoseong(text) {
  const CHOSEONG_LIST = ['ã„±', 'ã„²', 'ã„´', 'ã„·', 'ã„¸', 'ã„¹', 'ã…', 'ã…‚', 'ã…ƒ', 'ã……',
                        'ã…†', 'ã…‡', 'ã…ˆ', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'];
  return Array.from(text).map(char => {
    const code = char.charCodeAt(0);
    if (code >= 0xAC00 && code <= 0xD7A3) {
      const choseongIndex = Math.floor((code - 0xAC00) / 588);
      return CHOSEONG_LIST[choseongIndex];
    }
    return char; // í•œê¸€ ì•„ë‹ˆë©´ ê·¸ëŒ€ë¡œ
  }).join('');
}

function applyHint() {
  const inputs = document.querySelectorAll('.answer-input');
  inputs.forEach(input => {
    const answer = input.dataset.answer.trim();
    const userInput = input.value.trim();

    if (userInput === answer) {
      // ì •ë‹µì´ ì´ë¯¸ ì…ë ¥ëœ ê²½ìš° placeholder ì§€ì›€
      input.placeholder = '';
      return;
    } else if (userInput !== "") {
      // ì˜¤ë‹µì´ ì…ë ¥ëœ ê²½ìš° ì…ë ¥ê°’ ì´ˆê¸°í™”
      input.value = '';
    }

    // íŒíŠ¸ ìƒì„± (í•œê¸€ ì´ˆì„± ë˜ëŠ” ì˜ì–´ ì²« ê¸€ì)
    let hintText = '';
    if (/^[\uAC00-\uD7A3]+$/.test(answer)) {
      hintText = getChoseong(answer);
    } else {
      hintText = answer[0];
    }

    // íŒíŠ¸ë¥¼ placeholder ì†ì„±ì— ë„£ìŒ
    input.placeholder = hintText;
  });
}



// input í¬ì»¤ìŠ¤ ì‹œ íŒíŠ¸ ìˆ¨ê¸°ê¸° ì´ë²¤íŠ¸
document.addEventListener('focusin', (e) => {
  if (e.target.classList.contains('answer-input')) {
    const hintSpan = e.target.parentElement.querySelector('.hint-text');
    if (hintSpan) {
      hintSpan.style.display = 'none';
    }
  }
});


// ì •ë‹µ í™•ì¸ ê¸°ëŠ¥

function checkAnswer() {
  let allCorrect = true;

  document.querySelectorAll('.answer-input').forEach(input => {
    const correct = input.dataset.answer;
    if (input.value.trim() !== correct) {
      allCorrect = false;
      input.style.border = '1px dashed #e35c6a';
    } else {
      input.style.border = '1px dashed #56b89e';
    }
  });

  if (allCorrect) {
    launchSmallFireworks(); // âœ¨ í­ì£½ ì‹œì‘
    showTooltip('ì¶•í•˜í•©ë‹ˆë‹¤. ì •ë‹µì…ë‹ˆë‹¤. ë‹¤ìŒë¬¸ì œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.');
    setTimeout(() => {
      moveToNextCard();
    }, 3000);
  } else {
    showTooltip('í‹€ë ¸ìŠµë‹ˆë‹¤.');
  }
}

// ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™
function moveToNextCard() {
  document.querySelectorAll('.answer-input').forEach(i => i.style.border = '');
  if (randomMode) {
    shufflePointer++;
    if (shufflePointer >= shuffledIndices.length) initShuffledIndices();
  } else {
    currentIndex++;
    if (currentIndex >= getFilteredLength()) currentIndex = 0;
  }
  renderCard();
}


// renderCard í™•ì¥ (ê²Œì„ëª¨ë“œ ëŒ€ì‘)
const originalRenderCard = renderCard;
renderCard = function() {
  originalRenderCard();

  if (!currentCategory || !gameMode) {
    return;
  }

  const data = quizData[currentCategory];
  const realIndex = getRealIndex(currentIndex);
  const card = favoriteFilter
    ? data.filter((item, idx) => favorites.has(getKey(currentCategory, idx)))[currentIndex]
    : data[realIndex];

  const converted = convertAnswerToInputs(card.A);
  answerBox.classList.remove('hidden');
  answerBox.innerHTML = converted;
};

// ë²„íŠ¼ ì—°ê²°
hintBtn.onclick = applyHint;
checkBtn.onclick = checkAnswer;

//ì„¸íŒ…ë©”ë‰´
function toggleSettingsMenu() {
  const menu = document.getElementById('settings-menu');
  menu.classList.toggle('show');
}

function closeSettingsMenu() {
  const menu = document.getElementById('settings-menu');
  menu.classList.remove('show');
}

// ë‚˜ê°€ê¸° í•¨ìˆ˜ ì˜ˆì‹œ (í•„ìš”ì‹œ ë‚´ë¶€ ì‘ì—… í›„ ë©”ë‰´ ë‹«ê¸°)
function exitApp() {
  // ì‹¤ì œ ë‚˜ê°€ê¸° ë™ì‘ ë„£ê¸° (ì˜ˆ: í˜ì´ì§€ ì´ë™, ë¡œê·¸ì•„ì›ƒ ë“±)
  console.log("ë‚˜ê°€ê¸° ë™ì‘ ì‹¤í–‰");

  // ë©”ë‰´ ë‹«ê¸°
  closeSettingsMenu();
}

// ì™¸ë¶€ í´ë¦­ ì‹œ ë©”ë‰´ ë‹«ê¸°
document.addEventListener('click', function(event) {
  const menu = document.getElementById('settings-menu');
  const settingsIcon = document.querySelector('.settings-icon');
  if (!menu.contains(event.target) && !settingsIcon.contains(event.target)) {
    closeSettingsMenu();
  }
});



//ì¹´ë“œí¸ì§‘

  // ì €ì¥í‚¤
  const STORAGE_KEY = 'memoryCards';

   // íŒì—… ì—´ê¸°
  function openCardEditorPopup() {
    document.getElementById('cardEditorPopup').style.display = 'block';
    loadCardTitles();
  }

  // íŒì—… ë‹«ê¸°
  function closeCardEditorPopup() {
    document.getElementById('cardEditorPopup').style.display = 'none';
  }

  // ì¹´ë“œ ì œëª© ë¦¬ìŠ¤íŠ¸ë¥¼ ë©”ë‰´ì—ì„œ ë¶ˆëŸ¬ì˜¤ëŠ” ë¡œì§ ì°¸ê³ í•´ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
  function loadCardTitles() {
  const selector = document.getElementById('cardSelector');
  selector.innerHTML = '';

  const titles = Object.keys(quizData); // quizDataì—ì„œ ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì¶”ì¶œ

  if (titles.length === 0) {
    const opt = document.createElement('option');
    opt.value = '';
    opt.textContent = 'ì €ì¥ëœ ì•”ê¸°ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.';
    opt.disabled = true;
    opt.selected = true;
    selector.appendChild(opt);
    return;
  }

  titles.forEach(title => {
    const opt = document.createElement('option');
    opt.value = title;
    opt.textContent = title;
    selector.appendChild(opt);
  });

  // ì²« ë²ˆì§¸ í•­ëª© ì„ íƒ ë° ë‚´ìš© í‘œì‹œ
  selector.selectedIndex = 0;
  onCardTitleChange();
}

  // ì„ íƒëœ ì¹´ë“œ ì œëª© ë³€ê²½ì‹œ ë‚´ìš© í‘œì‹œ
function onCardTitleChange() {
  const title = document.getElementById('cardSelector').value;

  if (!title || !quizData[title]) {
    document.getElementById('cardTitleInput').value = '';
    document.getElementById('cardEditorTextarea').value = '';
    return;
  }

  const data = quizData[title]; // [{Q,A}, ...]

  document.getElementById('cardTitleInput').value = title;

  // ì§ˆë¬¸ê³¼ ë‹µë³€ì„ "ì§ˆë¬¸ // ë‹µë³€" í˜•ì‹ì˜ í•œ ì¤„ë¡œ ë§Œë“¤ê¸°
  const lines = data.map(item => `${item.Q} // ${item.A}`);

  // ê° ì¤„ì„ ê°œí–‰(\n)ìœ¼ë¡œ ì—°ê²°í•´ì„œ í…ìŠ¤íŠ¸ ì˜ì—­ì— ë„£ê¸°
  document.getElementById('cardEditorTextarea').value = lines.join('\n');
}



  // ì ìš© ë²„íŠ¼ í´ë¦­ (ë‚´ìš© ì €ì¥)
function applyCardChanges() {
  const selector = document.getElementById('cardSelector');
  const selectedValue = selector.value;
  const titleInput = document.getElementById('cardTitleInput');
  const textarea = document.getElementById('cardEditorTextarea');

  const newTitle = titleInput.value.trim();
  const rawText = textarea.value.trim();

  if (!selectedValue || !rawText) {
    alert('ì¹´í…Œê³ ë¦¬ì™€ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }

  // ë‚´ìš© íŒŒì‹±
  const lines = rawText.split('\n').map(line => line.trim()).filter(line => line.includes('//'));
  const parsedCards = lines.map(line => {
    const [Q, A] = line.split('//');
    return { Q: Q.trim(), A: A.trim() };
  });

  // ìƒˆ ì œëª©ì´ ê¸°ì¡´ ê²ƒê³¼ ë‹¤ë¥´ë©´ ì´ë¦„ ë³€ê²½
  const oldTitle = selectedValue;
  if (oldTitle !== newTitle) {
    // ìƒˆ ì œëª© ì¤‘ë³µ ì²´í¬
    if (quizData[newTitle]) {
      alert('ê°™ì€ ì œëª©ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.');
      return;
    }
    quizData[newTitle] = parsedCards;
    delete quizData[oldTitle];

    // ì¦ê²¨ì°¾ê¸° í‚¤ë„ ë³€ê²½
    const newFavorites = new Set();
   favorites.forEach(key => {
  if (typeof key === 'string' && key.startsWith(oldTitle + '_')) {
    const idx = key.split('_')[1];
    newFavorites.add(newTitle + '_' + idx);
  } else {
    newFavorites.add(key);
  }
});
    favorites = newFavorites;

    if (currentCategory === oldTitle) currentCategory = newTitle;
  } else {
    // ê¸°ì¡´ ì œëª© ê·¸ëŒ€ë¡œì¼ ê²½ìš° ë°ì´í„°ë§Œ ë®ì–´ì“°ê¸°
    quizData[oldTitle] = parsedCards;
  }

  // ë¡œì»¬ ì €ì¥

  localStorage.setItem('allQuizData', JSON.stringify(quizData));

  saveStatesToStorage();

  // ì½¤ë³´ë°•ìŠ¤ ë° í’€ë‹¤ìš´ ë©”ë‰´ ê°±ì‹ 

  updateCardSelectorOptions();
  createMenu();
  renderCard();

  // ì½¤ë³´ë°•ìŠ¤, ì…ë ¥ í•„ë“œ ì´ˆê¸°í™” í›„ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
  selector.value = newTitle;
  onCardTitleChange();

  showTooltip('ë³€ê²½ì‚¬í•­ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.');




}


//ì¹´ë“œì„ í… ì½¤ë³´ë°•ìŠ¤ ì—…ë°ì´íŠ¸

function updateCardSelectorOptions() {
  const selector = document.getElementById('cardSelector');
  selector.innerHTML = '';
  categories = Object.keys(quizData);

  categories.forEach(title => {
    const opt = document.createElement('option');
    opt.value = title;
    opt.textContent = title;
    selector.appendChild(opt);
  });
}

  // ìƒˆë¡œìš´ ì•”ê¸°ì¹´ë“œ ë§Œë“¤ê¸° ë²„íŠ¼ í´ë¦­
function prepareNewCard() {
  const newTitle = prompt("ìƒˆ ì•”ê¸°ì¹´ë“œ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”:");
  if (!newTitle) return;

  if (quizData[newTitle]) {
    alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì œëª©ì…ë‹ˆë‹¤.");
    return;
  }

  quizData[newTitle] = [];
  categories = Object.keys(quizData);

  // ìƒˆ ì œëª©ìœ¼ë¡œ ì…€ë ‰í„° ê°±ì‹ 
  const selector = document.getElementById('cardSelector');
  const option = document.createElement('option');
  option.value = newTitle;
  option.textContent = newTitle;
  selector.appendChild(option);
  selector.value = newTitle;

  // í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
  document.getElementById('cardEditorTextarea').value = '';
  document.getElementById('cardTitleInput').value = newTitle;
 const textarea = document.getElementById('cardEditorTextarea');

  textarea.value =
`ë¬¸ì œ1 // ì •ë‹µ1
ë¬¸ì œ2 // ì •ë‹µ2
ë¬¸ì œ3 // ì •ë‹µ3
ë¬¸ì œ4 // ì •ë‹µ4
ë¬¸ì œ5 // ì •ë‹µ5`;

  // ì¦‰ì‹œ ì €ì¥
  localStorage.setItem('allQuizData', JSON.stringify(quizData));
}

function deleteSelectedCard() {
  const selector = document.getElementById('cardSelector');
  let selectedCategory = selector.value;

  if (!selectedCategory) {
    alert('ì‚­ì œí•  ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
    return;
  }

  if (!confirm(`'${selectedCategory}' ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

  // 1. ì‹¤ì œ ì¹´í…Œê³ ë¦¬ ì‚­ì œ ë° ë¡œì»¬ ì €ì¥
  delete quizData[selectedCategory];
  categories = Object.keys(quizData);
  localStorage.setItem('allQuizData', JSON.stringify(quizData));

  // 2. ì½¤ë³´ë°•ìŠ¤ ì—…ë°ì´íŠ¸
  loadCardTitles();

  // 3. ì„ íƒëœ ì¹´í…Œê³ ë¦¬ ì²˜ë¦¬ ë° íŒì—… ë‚´ë¶€ ì…ë ¥ ì´ˆê¸°í™”
  if (categories.length === 0) {
    // ìƒˆ ì¹´í…Œê³ ë¦¬ ìƒì„±
    const newCategory = "ìƒˆ ì¹´ë“œ";
    quizData[newCategory] = [{ Q: "ë¬¸ì œ", A: "ì •ë‹µ" }];
    categories.push(newCategory);
    localStorage.setItem('allQuizData', JSON.stringify(quizData));

    loadCardTitles();
    selector.value = newCategory;
    document.getElementById('cardTitleInput').value = newCategory;
    document.getElementById('cardEditorTextarea').value = "ë¬¸ì œ // ì •ë‹µ";

    currentCategory = newCategory;
  } else {
    selector.value = categories[0];
    document.getElementById('cardTitleInput').value = categories[0];

    const entries = quizData[categories[0]];
    document.getElementById('cardEditorTextarea').value = entries.map(e => `${e.Q} // ${e.A}`).join('\n');

    currentCategory = categories[0];
  }

  currentIndex = 0; // ì¸ë±ìŠ¤ ì´ˆê¸°í™”

  // 4. ë©”ë‰´ ë° ë©”ì¸ ì¹´ë“œ í™”ë©´ ì—…ë°ì´íŠ¸
  
  createMenu();
  renderCard();

  showTooltip('ì¹´ë“œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');

  // 5. íŒì—…ì°½ ë‹«ê¸° ë° ë‹¤ì‹œ ì—´ê¸° (ì„ íƒ ì‚¬í•­)
  closeCardEditorPopup();
  setTimeout(() => {
    openCardEditorPopup();
  }, 100);

}


// ğŸ”µ 1. ì´ˆê¸°í™”: quizData.jsì˜ ì´ˆê¸° ë°ì´í„°ë¡œ ë˜ëŒë¦¼
function resetToInitialData() {
  if (!confirm("ì •ë§ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

  // quizData.jsì—ì„œ ê°€ì ¸ì˜¨ ì›ë³¸ ë°ì´í„° ì‚¬ìš©
  localStorage.setItem('allQuizData', JSON.stringify(originalQuizData));

  alert("ì´ˆê¸°í™” ì™„ë£Œë¨:\n" + JSON.stringify(originalQuizData, null, 2));
  location.reload();
}

// ğŸ”µ 2. ë°±ì—…: í˜„ì¬ ë¡œì»¬ ë°ì´í„°ë¥¼ JSON íŒŒì¼ë¡œ ì €ì¥
function backupQuizData() {
  const data = localStorage.getItem('allQuizData');
  if (!data) {
    alert('ë°±ì—…í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
    return;
  }

  const blob = new Blob([data], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;

  const now = new Date();
  const filename = `ì•”ê¸°ì¹´ë“œë°±ì—…_${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}.json`;
  a.download = filename;
  a.click();
  URL.revokeObjectURL(url);
}

// ğŸ”µ 3. ë³µêµ¬: JSON íŒŒì¼ ì—…ë¡œë“œí•˜ì—¬ ë°˜ì˜
function restoreFromFile() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';

  input.onchange = async (event) => {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
      try {
        const restored = JSON.parse(e.target.result);
        localStorage.setItem('allQuizData', JSON.stringify(restored));
        alert('ë³µêµ¬ ì™„ë£Œ! í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
        location.reload();
      } catch (err) {
        alert('ì˜ëª»ëœ JSON íŒŒì¼ì…ë‹ˆë‹¤.');
      }
    };
    reader.readAsText(file);
  };

  input.click();
}


</script>


</body>
</html>